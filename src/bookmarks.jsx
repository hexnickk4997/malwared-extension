import { List } from 'antd'
import React, { useEffect, useState } from 'react'

const getBookmarks = () => new Promise((resolve) => {
    chrome.bookmarks.getTree(resolve)
}) 

// https://developer.chrome.com/docs/extensions/reference/bookmarks/#type-BookmarkTreeNode
const bookmarkToUrls = (bookmark) => [bookmark.url, ...bookmarksToUrls(bookmark.children)]
const bookmarksToUrls = (bookmarks) => bookmarks != null 
    ? bookmarks
        .reduce((acc, cur) => [...acc, ...bookmarkToUrls(cur)], [])
        .filter(item => item != null) 
    : []

export const Bookmarks = () => {
    const [urls, setUrls] = useState([])

    useEffect(() => {
        (async () => {
            const bookmarks = await getBookmarks()
            console.log(bookmarks)
            const urls = bookmarksToUrls(bookmarks).slice(0, 10)
            setUrls(urls)
        })()
    }, [])

    return <List
        header={<strong>Most recent bookmarks</strong>}
        bordered
        dataSource={urls}
        renderItem={(item) => (
            <List.Item>{item}</List.Item>
        )}
    />
}