import React, { useEffect, useState } from 'react'
import { Table } from 'antd'

const getAllCookies = async () => {
    const stores = await chrome.cookies.getAllCookieStores()
    const cookiesPerStore = await Promise.all(stores.map(store => chrome.cookies.getAll({ storeId: store.id})))
    return cookiesPerStore.reduce((acc, cur) => [...acc, ...cur])
}

const columns = [
  {
    title: 'domain',
    dataIndex: 'domain',
  },
  {
    title: 'name',
    dataIndex: 'name',
  },
  {
    title: 'value',
    dataIndex: 'value',
  },
  {
    title: 'httpOnly',
    dataIndex: 'httpOnly',
    render: (value) => value ? '✅' : '❌'
  },
  {
    title: 'secure',
    dataIndex: 'secure',
    render: (value) => value ? '✅' : '❌'
  },
]

export const Cookies = () => {
    const [cookies, setCookies] = useState([])
    useEffect(() => {
        (async () => {
            const cookies = await getAllCookies()
            console.log(cookies)
            setCookies(cookies.slice(0, 10))
        })()
    }, [])

    return <>
        <h4>Your most recent cookies</h4>
        <Table dataSource={cookies} columns={columns} scroll={{ x: true }} pagination={{ hideOnSinglePage: true }}/>
    </>
}